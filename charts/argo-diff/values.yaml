# Default values for argo-diff
# This is a YAML-formatted file.

replicaCount: 1

image:
  repository: ghcr.io/tamcore/argo-diff
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

# OIDC configuration for GitHub Actions token validation
oidc:
  issuer: "https://token.actions.githubusercontent.com"
  audience: "argo-diff"

# Allowed repositories (comma-separated)
# Example: "owner/repo1,owner/repo2"
allowedRepos: ""

# Logging configuration
logging:
  level: "info"  # debug, info, warn, error

# ArgoCD configuration
argocd:
  # ArgoCD server address (default assumes in-cluster deployment)
  server: "argocd-server:80"
  # Use plain HTTP instead of HTTPS (true when using in-cluster service on port 80)
  plaintext: true

# Worker configuration
workers:
  count: 5
  queueSize: 100

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use
  # If not set and create is true, a name is generated using the fullname template
  name: ""

podAnnotations: {}

podSecurityContext:
  runAsNonRoot: true
  runAsUser: 65534
  runAsGroup: 65534
  fsGroup: 65534

securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true
  capabilities:
    drop:
      - ALL

service:
  type: ClusterIP
  port: 8080

metricsService:
  enabled: true
  port: 9090

ingress:
  enabled: false
  className: ""
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # kubernetes.io/tls-acme: "true"
    # nginx.ingress.kubernetes.io/proxy-read-timeout: "300"
  hosts:
    - host: argo-diff.local
      paths:
        - path: /
          pathType: Prefix
  tls: []
  #  - secretName: argo-diff-tls
  #    hosts:
  #      - argo-diff.local

resources:
  limits:
    cpu: 500m
    memory: 256Mi
  requests:
    cpu: 100m
    memory: 128Mi

# Autoscaling is disabled by default - this service handles async jobs
# and scaling is typically not needed
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 3
  targetCPUUtilizationPercentage: 80
  # targetMemoryUtilizationPercentage: 80

nodeSelector: {}

tolerations: []

affinity: {}

# Pod Disruption Budget
podDisruptionBudget:
  enabled: true
  minAvailable: 1

# Prometheus ServiceMonitor
serviceMonitor:
  enabled: false
  interval: 30s
  scrapeTimeout: 10s
  labels: {}
  # Additional labels to add to the ServiceMonitor
  # release: prometheus

# Liveness and readiness probes
probes:
  liveness:
    enabled: true
    initialDelaySeconds: 5
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  readiness:
    enabled: true
    initialDelaySeconds: 5
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
